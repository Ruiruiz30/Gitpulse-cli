# GitPulse

**[English](README.md) | [简体中文](README.zh-CN.md) | [日本語](README.ja.md) | [한국어](README.ko.md)**

AI を活用した Git コントリビューション分析ツール。コミットを分析し、開発者の貢献を複数の次元でスコアリングし、パフォーマンスレポートを生成します。

## 機能

- 多次元スコアリング：コード品質、複雑度とインパクト、コミット規律、コラボレーション
- Markdown ファイルによるカスタマイズ可能な評価基準（Rubric）
- 複数の LLM プロバイダー対応（OpenAI、Anthropic、Google、カスタムエンドポイント）
- コスト効率の良いスマートバッチ処理
- インクリメンタルキャッシュ — 新しいコミットのみを分析
- 複数の出力形式：ターミナル、JSON、Markdown、HTML
- プライバシー制御：匿名化、コンテンツ除外

## クイックスタート

```bash
# グローバルインストール
npm install -g gitpulse

# 設定（インタラクティブウィザード）
gitpulse config --init

# リポジトリを分析
gitpulse analyze . --max-commits 10

# 異なる形式でレポートを生成
gitpulse analyze . --format json -o report.json
gitpulse analyze . --format html -o report.html

# 2人の開発者を比較
gitpulse compare "Alice" "Bob"
```

## ホームディレクトリ（`~/.gitpulse/`）

初回実行時（`gitpulse config --init` または任意の `gitpulse analyze`）にグローバルホームディレクトリが自動的に作成されます：

```
~/.gitpulse/
├── rubrics/                       # デフォルト評価基準ファイル（編集可能）
│   ├── code-quality.md
│   ├── complexity-impact.md
│   ├── commit-discipline.md
│   └── collaboration.md
├── history/                       # 分析履歴（実行ごとに1つの JSON）
│   └── {repoName}_{YYYYMMDD-HHmmss}_{id}.json
├── memory/                        # エージェントメモリ
│   └── agent-memory.json
└── config.yml                     # グローバル設定
```

- **rubrics/** — 初回初期化時に組み込みデフォルトからコピーされます。グローバルなスコアリングをカスタマイズするためにこれらのファイルを編集できます。以降の実行で上書きされることはありません。
- **history/** — 各分析実行後にスコア、コスト、所要時間を含むサマリー JSON を書き込みます。
- **memory/** — リポジトリごとの分析回数、移動平均スコア、推定されたユーザー設定（プロバイダー、モデル、出力形式）を蓄積します。
- **config.yml** — グローバルフォールバック設定（下記「設定」セクションを参照）。

## 設定

GitPulse は [cosmiconfig](https://github.com/cosmiconfig/cosmiconfig) を使用して設定を管理します。設定は以下の優先順位で解決されます：

1. **プロジェクトレベル** — プロジェクトルートの `.gitpulse.yml`（または他の cosmiconfig 対応形式）
2. **グローバルレベル** — `~/.gitpulse/config.yml`
3. **組み込みデフォルト** — Zod スキーマのデフォルト値

プロジェクトルートに `.gitpulse.yml` を作成するか、`~/.gitpulse/config.yml` を編集してください：

```yaml
provider: openai
model: gpt-4o

scoring:
  weights:
    codeQuality: 0.30
    complexityImpact: 0.25
    commitDiscipline: 0.25
    collaboration: 0.20
  timeDecay: false
  maxTokensPerDiff: 8000

analysis:
  maxConcurrency: 3
  skipMergeCommits: true
  skipLockFiles: true
  skipAutoGenerated: true

output:
  format: terminal
  anonymize: false

privacy:
  excludeFileContents: false
  anonymize: false
```

環境変数で API キーを設定：

```bash
export OPENAI_API_KEY=sk-...
# または
export ANTHROPIC_API_KEY=sk-ant-...
```

## カスタム評価基準

評価基準ファイルは以下の順序で検索されます：

1. プロジェクトレベル：`<repo>/.gitpulse/rubrics/`
2. グローバル：`~/.gitpulse/rubrics/`
3. パッケージに同梱された組み込みデフォルト

いずれかの場所に Markdown ファイルを配置してデフォルトの評価基準を上書きできます：

```
.gitpulse/
  rubrics/
    code-quality.md
    complexity-impact.md
    commit-discipline.md
    collaboration.md
```

`gitpulse config --init` を実行すると `~/.gitpulse/rubrics/` に組み込みデフォルトが展開されます。必要に応じて編集してください。デフォルトの評価基準形式については、本リポジトリの `rubrics/` ディレクトリを参照してください。

## CLI コマンド

```
gitpulse analyze [path]        リポジトリのコントリビューションを分析
  -b, --branch <branch>        分析するブランチを指定
  --since / --until <date>     日付範囲
  --author <names...>          著者でフィルタ
  --max-commits <n>            コミット数を制限
  --format <type>              terminal | json | markdown | html
  -o, --output <path>          出力ファイル
  --no-cache                   強制的に再スコアリング
  -y, --yes                    確認をスキップ
  --provider <type>            LLM プロバイダーを上書き
  --model <name>               モデルを上書き

gitpulse report [path]         キャッシュからレポートを生成
gitpulse config --init         ~/.gitpulse/ を初期化 + インタラクティブ設定
gitpulse config --show         現在の設定を表示
gitpulse compare <a1> <a2>     2人の開発者を比較
```

`gitpulse analyze` を実行するたびに自動的に：

- `~/.gitpulse/` が存在しない場合は作成
- 分析結果を `~/.gitpulse/history/` に記録
- `~/.gitpulse/memory/agent-memory.json` のエージェントメモリを更新

## パッケージ

| パッケージ | 説明 |
|-----------|------|
| `@gitpulse/core` | コア分析エンジン、スコアリング、レポート生成 |
| `gitpulse` | CLI ツール |

## 開発

```bash
# 依存関係をインストール
pnpm install

# 全パッケージをビルド
pnpm build

# テストを実行
pnpm test

# リント
pnpm lint
```

## プライバシーと倫理

- diff コンテンツのみが LLM API に送信され、完全なファイルは送信されません
- `excludeFileContents: true` を設定すると統計データのみを送信
- 匿名化モードは名前を決定論的な仮名に置換
- スコアはコントリビューションの特性を測定するものであり、開発者の価値を測るものではありません

## ライセンス

[Apache-2.0](LICENSE)
