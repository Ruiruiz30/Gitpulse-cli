# GitPulse

**[English](README.md) | [简体中文](README.zh-CN.md) | [日本語](README.ja.md) | [한국어](README.ko.md)**

基于 AI 的 Git 贡献分析器。分析提交记录，从多个维度对开发者贡献进行评分，并生成绩效报告。

## 功能特性

- 多维度评分：代码质量、复杂度与影响力、提交规范、协作能力
- 可自定义的 Markdown 评分标准（Rubric）
- 支持多种 LLM 提供商（OpenAI、Anthropic、Google、自定义端点）
- 智能批处理，降低分析成本
- 增量缓存 — 仅分析新增提交
- 多种输出格式：终端、JSON、Markdown、HTML
- 隐私控制：匿名化、内容排除

## 快速开始

```bash
# 全局安装
npm install -g gitpulse-cli

# 配置（交互式向导）
gitpulse config --init

# 分析仓库
gitpulse analyze . --max-commits 10

# 以不同格式生成报告
gitpulse analyze . --format json -o report.json
gitpulse analyze . --format html -o report.html

# 对比两位开发者
gitpulse compare "Alice" "Bob"
```

## 主目录（`~/.gitpulse/`）

首次运行 `gitpulse config --init` 或任意 `gitpulse analyze` 命令时，会自动创建全局主目录：

```
~/.gitpulse/
├── rubrics/                       # 默认评分标准文件（可直接编辑）
│   ├── code-quality.md
│   ├── complexity-impact.md
│   ├── commit-discipline.md
│   └── collaboration.md
├── history/                       # 分析历史（每次运行生成一个 JSON）
│   └── {repoName}_{YYYYMMDD-HHmmss}_{id}.json
├── memory/                        # Agent 记忆
│   └── agent-memory.json
└── config.yml                     # 全局配置
```

- **rubrics/** — 首次初始化时从内置默认文件复制。可直接编辑以自定义全局评分标准，后续运行不会覆盖已有文件。
- **history/** — 每次分析运行后写入摘要 JSON，包含评分、成本和耗时信息。
- **memory/** — 累积每个仓库的分析次数、滚动平均分以及推断出的用户偏好（提供商、模型、输出格式）。
- **config.yml** — 全局回退配置（详见下方"配置"章节）。

## 配置

GitPulse 使用 [cosmiconfig](https://github.com/cosmiconfig/cosmiconfig) 进行配置管理。配置按以下优先级解析：

1. **项目级** — 项目根目录下的 `.gitpulse.yml`（或其他 cosmiconfig 支持的格式）
2. **全局级** — `~/.gitpulse/config.yml`
3. **内置默认值** — Zod schema 默认值

在项目根目录创建 `.gitpulse.yml` 或编辑 `~/.gitpulse/config.yml`：

```yaml
provider: openai
model: gpt-4o

scoring:
  weights:
    codeQuality: 0.30
    complexityImpact: 0.25
    commitDiscipline: 0.25
    collaboration: 0.20
  timeDecay: false
  maxTokensPerDiff: 8000

analysis:
  maxConcurrency: 3
  skipMergeCommits: true
  skipLockFiles: true
  skipAutoGenerated: true

output:
  format: terminal
  anonymize: false

privacy:
  excludeFileContents: false
  anonymize: false
```

通过环境变量设置 API Key：

```bash
export OPENAI_API_KEY=sk-...
# 或
export ANTHROPIC_API_KEY=sk-ant-...
```

## 自定义评分标准

评分标准文件按以下顺序搜索：

1. 项目级：`<repo>/.gitpulse/rubrics/`
2. 全局级：`~/.gitpulse/rubrics/`
3. 包内置默认文件

在以上任一位置放置 Markdown 文件即可覆盖默认评分标准：

```
.gitpulse/
  rubrics/
    code-quality.md
    complexity-impact.md
    commit-discipline.md
    collaboration.md
```

运行 `gitpulse config --init` 将内置默认文件填充到 `~/.gitpulse/rubrics/`，然后根据需要进行编辑。默认评分标准格式参见本仓库的 `rubrics/` 目录。

## CLI 命令

```
gitpulse analyze [path]        分析仓库贡献
  -b, --branch <branch>        指定分析分支
  --since / --until <date>     日期范围
  --author <names...>          按作者过滤
  --max-commits <n>            限制提交数量
  --format <type>              terminal | json | markdown | html
  -o, --output <path>          输出文件路径
  --no-cache                   强制重新评分
  -y, --yes                    跳过确认提示
  --provider <type>            覆盖 LLM 提供商
  --model <name>               覆盖模型

gitpulse report [path]         从缓存生成报告
gitpulse config --init         初始化 ~/.gitpulse/ + 交互式设置
gitpulse config --show         显示当前配置
gitpulse compare <a1> <a2>     对比两位开发者
```

每次 `gitpulse analyze` 运行时自动：

- 若 `~/.gitpulse/` 不存在则创建
- 将分析结果记录到 `~/.gitpulse/history/`
- 更新 `~/.gitpulse/memory/agent-memory.json` 中的 Agent 记忆

## 包结构

| 包名 | 描述 |
|------|------|
| `@gitpulse/core` | 核心分析引擎、评分与报告生成 |
| `gitpulse-cli` | CLI 工具 |

## 开发

```bash
# 安装依赖
pnpm install

# 构建所有包
pnpm build

# 运行测试
pnpm test

# 代码检查
pnpm lint
```

## 隐私与伦理

- 仅将 diff 内容发送至 LLM API，而非完整文件
- 配置 `excludeFileContents: true` 可仅发送统计数据
- 匿名化模式将姓名替换为确定性的假名
- 评分衡量的是贡献特征，而非开发者的价值

## 许可证

[Apache-2.0](LICENSE)
